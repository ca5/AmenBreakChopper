# AmenBreakChopper

## 概要

入力された音声をBPMに同期したディレイで再生するビートチョッパー・エフェクトです。

JUCEフレームワークを使用して開発されたオーディオプラグインで、
ディレイタイム パラメータはMIDIノートによってコントロール可能です。

## 使い方

AmenBreakChopperは、MIDIノート入力を受け取り、それに応じてオーディオバッファの読み出し位置（ディレイタイム）を変更することで、入力されたビートをリアルタイムに「チョップ」します。

### パラメータ

| パラメータ名 | 説明 | デフォルト値 |
| --- | --- | --- |
| **Control Mode** | コントロールモード。`Internal` または `OSC`。 | Internal |
| **Delay Time** | 現在のディレイタイム（0-15）。MIDIノート入力により自動的に変更されます。 | 0 |
| **Sequence Position** | 現在のシーケンス位置（0-15）。 | 0 |
| **Note Sequence Position** | ノートシーケンスの位置（0-15）。 | 0 |
| **MIDI In Channel** | 受信するMIDIチャンネル（0=Omni, 1-16）。 | 0 |
| **MIDI Out Channel** | 送信するMIDIチャンネル（1-16）。 | 1 |
| **OSC Send Port** | OSC送信ポート。 | 9001 |
| **OSC Receive Port** | OSC受信ポート。 | 9002 |

### MIDIコントロール

#### ノート入力 (Note On)
- **ノート番号 0 - 15**:
  - 入力されたノート番号に応じて、バッファの読み出し位置が変更されます。
  - 具体的には、`DelayTime` が `(現在のシーケンス位置 - ノート番号) % 16` に基づいて計算されます。
  - これにより、過去の特定の拍の音を現在の拍で鳴らすことができます。
  - 拍をずらさなかった場合の本来のシーケンス位置は、ノート番号32-47でMIDI OUTされます

#### CC (コントロールチェンジ)
シーケンサーの状態をリセットしたり調整したりするためのコマンドです。

- **Seq Reset (デフォルトCC: 93)**:
  - シーケンスのリセットをキューに入れます。次のタイミングで シーケンス位置とノート番号をに同期します。
- **Hard Reset (デフォルトCC: 106)**:
  - ハードリセット（再生位置）のリセットをキューに入れます。シーケンス位置が 0 に戻り、ホストのBPMと位置情報に基づいて同期し直します。
- **Soft Reset (デフォルトCC: 97)*番号
  - ソフトリセット。シーケンス位置とノート番号を 0 にリセットします。
- **Delay Adjust Fwd/Bwd**:
  - 拍の微調整を行います。

### OSCコントロール
OSCコントロールモードでは以下のOSCメッセージを受信してコントロール可能です。
DAW内部でMIDI連携がしづらい場合などに利用します

- `/delayTime <int>`: ディレイタイムを直接設定 (0-15)
- `/sequenceReset`: シーケンスリセットを実行
- `/hardReset`: ハードリセットを実行
- `/softReset`: ソフトリセットを実行
- `/setNoteSequencePosition <int>`: ノートシーケンス位置を直接設定

## 開発ワークフロー

### Projucer

プロジェクトのビルド設定やファイル管理は、`AmenBreakChopper.jucer` ファイルをProjucerアプリケーションで開いて行います。
設定変更後は、必ず「Save Project and Open in IDE...」でXcodeプロジェクトを再生成してください。



## ビルドとインストール（macOS）

ビルド環境の問題により、DAWが古いプラグインを読み込む問題が頻発しました。
ビルド後の確実なテスト手順は以下の通りです：

1. Xcodeでプラグインをビルドする。
2. Xcodeの「Products」フォルダからビルドされた `.component` ファイルをFinderで表示する。
3. そのファイルを `/Library/Audio/Plug-Ins/Components/` にコピーし、既存のファイルを上書きする。
4. DAWを再起動してプラグインを読み込む。